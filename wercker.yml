box:
  id: rbkmoney/build_erlang
  username: $CI_BOT_GIT_USERNAME
  password: $CI_BOT_GIT_PASSWORD
  tag: latest

dev:
    steps:
      - internal/shell:
        code: make compile

build:
    steps:
      - script:
        name: rebar update
        code: make rebar-update
      - script:
        name: lint
        code: |
            export ELVIS_VERSION="0.2.11"
            export ELVIS_PATH="/usr/local/bin/elvis"
            curl -sL -o "${ELVIS_PATH}" "https://github.com/inaka/elvis/releases/download/${ELVIS_VERSION}/elvis"
            chmod +x "${ELVIS_PATH}"
            make lint
      - script:
        name: run xref
        code: make xref
      - script:
        name: run test suite
        code: make test
      - script:
        name: run dialyzer
        code: make dialyze
    after-steps:
      - slack-notifier:
        url: ${SLACK_WEBHOOK_URL}
        username: "wercker"

